<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>CppDB: Developing Your Own Backends</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">CppDB
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">CppDB - SQL Connectivity Library</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Developing Your Own Backends </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Even if your database is not supported directly by one of the backends, take a look on <a class="el" href="odbc.html">ODBC</a> backend, and see how well your database driver behaves with it. It may solve the problem for you.</p>
<p>Before you begin make sure you are familiar with CppDB library and know how to use it. Take a look to the source code of existing backends, it is good to take a look on <a class="el" href="postgresql.html">PostgreSQL</a> and <a class="el" href="sqlite3.html">Sqlite3</a> backends implementations.</p>
<h2><a class="anchor" id="backenddev_what_needed"></a>
What Need to Implement</h2>
<p>You need to implement following 3 classes:</p>
<ol type="1">
<li><a class="el" href="classcppdb_1_1backend_1_1connection.html" title="this class represents connection to database">cppdb::backend::connection</a> - the object that holds connection to the database - similar to <a class="el" href="classcppdb_1_1session.html" title="SQL session object that represents a single connection and is the gateway to SQL database.">cppdb::session</a>.</li>
<li><a class="el" href="classcppdb_1_1backend_1_1statement.html" title="This class represents a statement that can be either executed or queried for result.">cppdb::backend::statement</a> - the object that holds prepared (or unprepared) statement - similar to <a class="el" href="classcppdb_1_1statement.html" title="This class represents a prepared (or ordinary) statement that can be executed.">cppdb::statement</a></li>
<li><a class="el" href="classcppdb_1_1backend_1_1result.html" title="This class represents query result.">cppdb::backend::result</a> - the object that holds the result of query - similar to <a class="el" href="classcppdb_1_1result.html" title="This object represents query result.">cppdb::result</a></li>
</ol>
<p>You may safely assume that:</p>
<ul>
<li>As long as <a class="el" href="classcppdb_1_1backend_1_1result.html">result</a> exists, the <a class="el" href="classcppdb_1_1backend_1_1statement.html">statement</a> that created it would exist.</li>
<li>As long as <a class="el" href="classcppdb_1_1backend_1_1statement.html">statement</a> exists, the <a class="el" href="classcppdb_1_1backend_1_1connection.html">connection</a> that created it would exist.</li>
</ul>
<p>The frontend classes make sure that this happens.</p>
<h2><a class="anchor" id="backend_ref_dynamic"></a>
Making Loadable Module</h2>
<p>You need to implement a single entry point in your library with the <a class="el" href="namespacecppdb_1_1backend.html#a2024aa00cffdab93be5a9199e74e4ba0">following prototype</a>. It is very important to make the entry point function <code>extern</code> <code>"C"</code> so it would be resolved using dlsym or GetProcAddress functions and it should be marked as "__declspec(dllexport)" if it is compiled as Windows DLL.</p>
<p>It should be named it as <code>cppdb_xyz_get_connection</code> where <code>xyz</code> is the name of your backend.</p>
<p>It should receive as a parameter a const reference to <a class="el" href="classcppdb_1_1connection__info.html" title="Class that represents parsed connection string.">cppdb::connection_info</a> returning newly created <a class="el" href="classcppdb_1_1backend_1_1connection.html">connection</a>.</p>
<p>For example, in sqlite3 backend this function looks like this:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
        CPPDB_DRIVER_API <a class="code" href="classcppdb_1_1backend_1_1connection.html" title="this class represents connection to database">cppdb::backend::connection</a> *cppdb_sqlite3_get_connection(<a class="code" href="classcppdb_1_1connection__info.html" title="Class that represents parsed connection string.">cppdb::connection_info</a> <span class="keyword">const</span> &amp;cs)
        {
                <span class="keywordflow">return</span> <span class="keyword">new</span> cppdb::sqlite3_backend::connection(cs);
        }
}
</pre></div><p>The shared object or DLL themselves should be named as cppdb_xyz - so under Linux it would be libcppdb_xyz.so and under Windows MSVC it would be "cppdb_xyz.dll". It is also good idea to give it same soname as the libcppdb.so itself as it would allow keeping several backend versions for several versions of libcppdb in future as CppDB always tries to load a module as "libcppdb_xyz.so.V" and only then "libcppdb_xyz.so" where V is the current CppDB library soname.</p>
<h2><a class="anchor" id="backend_ref_static"></a>
Making Statically Linked only Module</h2>
<p>Of course if you want to link your module statically only, you do not have to create this single entry point function, you may derive from <a class="el" href="classcppdb_1_1backend_1_1driver.html" title="This class represents a driver that creates connections for given connection string, custom drivers can be are installed using this class.">cppdb::backend::driver</a> class such as its <a class="el" href="classcppdb_1_1backend_1_1driver.html#ab61f9b13e49967bffb287a2511071795">open()</a> function would return a new connection object and <a class="el" href="classcppdb_1_1backend_1_1driver.html#afc539adf787ba0c4ed3bbf9cf130e2db">in_use()</a> function would always return true so the module would not be "unloaded".</p>
<p>Such module can be installed using <a class="el" href="classcppdb_1_1driver__manager.html">cppdb::driver_manager</a> driver_manager singleton class using its <a class="el" href="classcppdb_1_1driver__manager.html#ab1b6107deef70ee54c0f112bbced287b">install_driver()</a> member function. For example:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">class </span>my_cool_sql_driver {
 <span class="keyword">public</span>:
    <a class="code" href="classcppdb_1_1backend_1_1connection.html" title="this class represents connection to database">cppdb::backend::connection</a> *open(<a class="code" href="classcppdb_1_1connection__info.html" title="Class that represents parsed connection string.">cppdb::connection_info</a> <span class="keyword">const</span> &amp;ci) {
       <span class="keywordflow">return</span> <span class="keyword">new</span> my_cool_sql::connection(ci);
    }
    <span class="keywordtype">bool</span> in_use() { <span class="keywordflow">return</span> <span class="keyword">true</span>; }
 };
 ...
 <a class="code" href="classcppdb_1_1driver__manager.html#ae8bacd9e4c11b1ad260b7098880e073a">cppdb::driver_manager::instance</a>().<a class="code" href="classcppdb_1_1driver__manager.html#ab1b6107deef70ee54c0f112bbced287b">install_driver</a>(<span class="stringliteral">&quot;mycoolsql&quot;</span>,<span class="keyword">new</span> my_cool_sql_driver());
</pre></div><p>Of course if you have the <code>extern</code> <code>"C"</code> function as shown above you can do the same trick using <a class="el" href="classcppdb_1_1backend_1_1static__driver.html" title="Create a static driver using connection function (usable for statically linking drivers).">cppdb::backend::static_driver</a>.</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
    <a class="code" href="classcppdb_1_1backend_1_1connection.html" title="this class represents connection to database">cppdb::backend::connection</a> *my_cool_sql_open(<a class="code" href="classcppdb_1_1connection__info.html" title="Class that represents parsed connection string.">cppdb::connection_info</a> <span class="keyword">const</span> &amp;ci) {
       <span class="keywordflow">return</span> <span class="keyword">new</span> my_cool_sql::connection(ci);
    }
 }
 ...
 <a class="code" href="classcppdb_1_1driver__manager.html#ae8bacd9e4c11b1ad260b7098880e073a">cppdb::driver_manager::instance</a>().<a class="code" href="classcppdb_1_1driver__manager.html#ab1b6107deef70ee54c0f112bbced287b">install_driver</a>(<span class="stringliteral">&quot;mycoolsql&quot;</span>,<span class="keyword">new</span> <a class="code" href="classcppdb_1_1backend_1_1static__driver.html" title="Create a static driver using connection function (usable for statically linking drivers).">cppdb::backend::static_driver</a>(my_cool_sql_open));
</pre></div><h2><a class="anchor" id="backend_tips"></a>
Tips</h2>
<ul>
<li>Use functions from <a class="el" href="utils_8h_source.html">utils.h</a> and <a class="el" href="numeric__util_8h_source.html">numeric_util.h</a> they are very helpful especially in converting data to and from textual representation.</li>
<li>When converting numbers to strings and backwards make sure you are using std::locale::classic(), otherwise when inserting 12345.678 you may accidentally get "12.345,678" which is probably not what you want. Do it as following: <div class="fragment"><pre class="fragment">  std::ostringstream ss;
  ss.imbue(std::locale::classic());
  ss &lt;&lt; number;
  std::string text_value = ss.str();
</pre></div> And do the same for parsing.</li>
<li>Try to reduce memory coping as much as possible when handing large texts and objects, remember that when std::string is binded it remains valid till actual statement execution so it is likely that you can just keep a reference on it rather then copying the string itself.</li>
<li>Don't bother too much about statements caching or connection pooling. Front-end classes do this for you. </li>
</ul>
</div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Sat Jun 23 2012 12:36:59 for CppDB by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
